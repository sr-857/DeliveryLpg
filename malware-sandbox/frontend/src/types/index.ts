// Core domain types for malware analysis sandbox

export interface User {
  id: string
  email: string
  username: string
  role: UserRole
  tenantId: string
  isActive: boolean
  lastLogin: Date
  createdAt: Date
  updatedAt: Date
  mfaEnabled: boolean
  permissions: Permission[]
}

export enum UserRole {
  ADMIN = 'admin',
  ANALYST = 'analyst',
  READONLY = 'readonly'
}

export enum Permission {
  VIEW_SAMPLES = 'view_samples',
  UPLOAD_SAMPLES = 'upload_samples',
  RUN_ANALYSIS = 'run_analysis',
  VIEW_REPORTS = 'view_reports',
  EXPORT_REPORTS = 'export_reports',
  MANAGE_USERS = 'manage_users',
  MANAGE_SYSTEM = 'manage_system',
  KILL_ANALYSIS = 'kill_analysis',
  ACCESS_QUARANTINE = 'access_quarantine'
}

export interface Tenant {
  id: string
  name: string
  domain: string
  branding: TenantBranding
  settings: TenantSettings
  createdAt: Date
  updatedAt: Date
  isActive: boolean
}

export interface TenantBranding {
  logo?: string
  primaryColor: string
  secondaryColor: string
  companyName: string
  supportEmail: string
}

export interface TenantSettings {
  maxSampleSize: number // MB
  maxAnalysisTime: number // minutes
  allowedFileTypes: string[]
  requireApproval: boolean
  enableNetworkAccess: boolean
  retentionDays: number
}

// Sample and Analysis Types
export interface Sample {
  id: string
  filename: string
  originalFilename: string
  fileSize: number
  fileType: string
  mimeType: string
  md5: string
  sha1: string
  sha256: string
  ssdeep?: string
  uploadDate: Date
  uploadedBy: string
  tenantId: string
  status: SampleStatus
  tags: string[]
  notes: string
  isQuarantined: boolean
  metadata: SampleMetadata
}

export enum SampleStatus {
  UPLOADING = 'uploading',
  PENDING = 'pending',
  SCANNING = 'scanning',
  ANALYZING = 'analyzing',
  COMPLETED = 'completed',
  FAILED = 'failed',
  QUARANTINED = 'quarantined'
}

export interface SampleMetadata {
  peInfo?: PEInfo
  elfInfo?: ELFInfo
  digitalSignature?: DigitalSignature
  imports: string[]
  exports: string[]
  sections: FileSection[]
  certificates: Certificate[]
  entropy: number
  compiled?: Date
}

export interface PEInfo {
  machine: string
  timestamp: string
  characteristics: string[]
  subsystem: string
  dllCharacteristics: string[]
  entryPoint: number
  imageBase: number
}

export interface ELFInfo {
  class: string
  data: string
  version: string
  osAbi: string
  type: string
  machine: string
  entryPoint: number
}

export interface DigitalSignature {
  signer: string
  issuer: string
  serialNumber: string
  validFrom: Date
  validTo: Date
  algorithm: string
  isTrusted: boolean
}

export interface FileSection {
  name: string
  virtualAddress: number
  size: number
  entropy: number
  characteristics: string[]
}

export interface Certificate {
  subject: string
  issuer: string
  serialNumber: string
  validFrom: Date
  validTo: Date
  fingerprint: string
}

// Analysis Types
export interface Analysis {
  id: string
  sampleId: string
  profile: AnalysisProfile
  status: AnalysisStatus
  startTime: Date
  endTime?: Date
  duration?: number
  verdict: Verdict
  score: number
  analystId?: string
  tenantId: string
  environment: AnalysisEnvironment
  configuration: AnalysisConfiguration
  createdAt: Date
  updatedAt: Date
}

export enum AnalysisStatus {
  QUEUED = 'queued',
  RUNNING = 'running',
  COMPLETED = 'completed',
  FAILED = 'failed',
  CANCELLED = 'cancelled',
  TIMEOUT = 'timeout'
}

export enum Verdict {
  MALICIOUS = 'malicious',
  SUSPICIOUS = 'suspicious',
  BENIGN = 'benign',
  UNKNOWN = 'unknown'
}

export interface AnalysisProfile {
  id: string
  name: string
  description: string
  timeout: number // seconds
  memoryLimit: number // MB
  cpuLimit: number // cores
  networkPolicy: NetworkPolicy
  enableScreenshots: boolean
  enableNetworkCapture: boolean
  enableFileMonitoring: boolean
  enableProcessMonitoring: boolean
  enableRegistryMonitoring: boolean
  yaraRules: string[]
  customRules: string[]
}

export enum NetworkPolicy {
  BLOCKED = 'blocked',
  ISOLATED = 'isolated',
  PROXY = 'proxy',
  ALLOWED = 'allowed'
}

export interface AnalysisEnvironment {
  os: string
  osVersion: string
  architecture: string
  hostname: string
  ipAddress: string
  macAddress: string
  vmId: string
  snapshotId: string
}

export interface AnalysisConfiguration {
  timeLimit: number
  memoryLimit: number
  cpuLimit: number
  networkPolicy: NetworkPolicy
  enableDynamicAnalysis: boolean
  enableStaticAnalysis: boolean
  enableYaraScanning: boolean
  customArguments: string[]
  environmentVariables: Record<string, string>
}

// Report Types
export interface AnalysisReport {
  id: string
  analysisId: string
  summary: ReportSummary
  staticAnalysis: StaticAnalysis
  dynamicAnalysis: DynamicAnalysis
  networkAnalysis: NetworkAnalysis
  yaraMatches: YaraMatch[]
  iocs: IOC[]
  screenshots: Screenshot[]
  events: AnalysisEvent[]
  tags: string[]
  analystNotes: AnalystNote[]
  artifacts: Artifact[]
  createdAt: Date
  updatedAt: Date
}

export interface ReportSummary {
  verdict: Verdict
  score: number
  confidence: number
  threatLevel: ThreatLevel
  malwareFamilies: string[]
  techniques: string[]
  keyFindings: string[]
  recommendations: string[]
}

export enum ThreatLevel {
  CRITICAL = 'critical',
  HIGH = 'high',
  MEDIUM = 'medium',
  LOW = 'low',
  INFO = 'info'
}

export interface StaticAnalysis {
  hashes: FileHashes
  fileProperties: FileProperties
  signatures: Signature[]
  imports: Import[]
  exports: Export[]
  sections: FileSection[]
  resources: Resource[]
  entropy: EntropyAnalysis
  packerInfo: PackerInfo
}

export interface FileHashes {
  md5: string
  sha1: string
  sha256: string
  sha512: string
  ssdeep?: string
  impHash?: string
  authentihash?: string
}

export interface FileProperties {
  fileName: string
  fileSize: number
  fileType: string
  mimeType: string
  creationTime?: Date
  modificationTime?: Date
  compileTime?: Date
  description?: string
  company?: string
  product?: string
  version?: string
}

export interface Signature {
  name: string
  vendor: string
  description: string
  severity: ThreatLevel
  category: string
}

export interface Import {
  dll: string
  function: string
  address: number
  ordinal?: number
}

export interface Export {
  name: string
  address: number
  ordinal?: number
}

export interface Resource {
  type: string
  language: string
  size: number
  md5: string
  sha256: string
}

export interface EntropyAnalysis {
  overall: number
  sections: SectionEntropy[]
  highEntropySections: string[]
  isPacked: boolean
  packerName?: string
}

export interface SectionEntropy {
  name: string
  entropy: number
  offset: number
  size: number
}

export interface PackerInfo {
  isPacked: boolean
  packerName?: string
  confidence: number
  entropyScore: number
}

export interface DynamicAnalysis {
  processes: Process[]
  fileSystem: FileSystemActivity
  registry: RegistryActivity
  network: NetworkActivity
  apiCalls: APICall[]
  behavioralAnalysis: BehavioralAnalysis
  persistence: PersistenceMechanism[]
}

export interface Process {
  pid: number
  ppid: number
  name: string
  path: string
  commandLine: string
  createTime: Date
  endTime?: Date
  parentProcess?: Process
  children: Process[]
  integrity: string
  isHidden: boolean
  isSystem: boolean
  privileges: string[]
}

export interface FileSystemActivity {
  createdFiles: FileOperation[]
  deletedFiles: FileOperation[]
  modifiedFiles: FileOperation[]
  renamedFiles: FileOperation[]
  copiedFiles: FileOperation[]
  encryptedFiles: FileOperation[]
}

export interface FileOperation {
  path: string
  operation: FileOperationType
  timestamp: Date
  processId: number
  processName: string
  size: number
  hash?: string
}

export enum FileOperationType {
  CREATE = 'create',
  DELETE = 'delete',
  MODIFY = 'modify',
  RENAME = 'rename',
  COPY = 'copy',
  ENCRYPT = 'encrypt'
}

export interface RegistryActivity {
  createdKeys: RegistryOperation[]
  deletedKeys: RegistryOperation[]
  modifiedKeys: RegistryOperation[]
  modifiedValues: RegistryOperation[]
}

export interface RegistryOperation {
  key: string
  value?: string
  type: string
  operation: RegistryOperationType
  timestamp: Date
  processId: number
  processName: string
}

export enum RegistryOperationType {
  CREATE_KEY = 'create_key',
  DELETE_KEY = 'delete_key',
  SET_VALUE = 'set_value',
  DELETE_VALUE = 'delete_value'
}

export interface NetworkActivity {
  connections: NetworkConnection[]
  dnsQueries: DNSQuery[]
  httpRequests: HTTPRequest[]
  downloadedFiles: DownloadedFile[]
}

export interface NetworkConnection {
  protocol: string
  localAddress: string
  localPort: number
  remoteAddress: string
  remotePort: number
  remoteHostname?: string
  remoteCountry?: string
  timestamp: Date
  processId: number
  processName: string
  bytesSent: number
  bytesReceived: number
  duration: number
  status: ConnectionStatus
}

export enum ConnectionStatus {
  ESTABLISHED = 'established',
  LISTENING = 'listening',
  CLOSED = 'closed',
  FAILED = 'failed'
}

export interface DNSQuery {
  domain: string
  queryType: string
  response?: string
  timestamp: Date
  processId: number
  processName: string
  responseTime?: number
  ttl?: number
}

export interface HTTPRequest {
  method: string
  url: string
  userAgent?: string
  referer?: string
  host: string
  statusCode?: number
  statusText?: string
  responseSize?: number
  timestamp: Date
  processId: number
  processName: string
}

export interface DownloadedFile {
  url: string
  localPath: string
  size: number
  hash?: string
  timestamp: Date
  processId: number
  processName: string
}

export interface APICall {
  functionName: string
  moduleName: string
  parameters: any[]
  returnValue?: any
  timestamp: Date
  processId: number
  threadId: number
  stackTrace?: StackFrame[]
}

export interface StackFrame {
  module: string
  function: string
  address: number
}

export interface BehavioralAnalysis {
  techniques: Technique[]
  killChain: KillChainPhase[]
  capabilities: Capability[]
  intent: MaliciousIntent[]
  confidence: number
}

export interface Technique {
  id: string
  name: string
  description: string
  tactic: string
  techniqueId: string
  confidence: number
  evidence: string[]
}

export interface KillChainPhase {
  phase: string
  techniques: string[]
  confidence: number
}

export interface Capability {
  name: string
  description: string
  category: string
  confidence: number
}

export interface MaliciousIntent {
  type: string
  description: string
  confidence: number
}

export interface PersistenceMechanism {
  type: string
  location: string
  value: string
  timestamp: Date
  processId: number
  processName: string
}

export interface NetworkAnalysis {
  protocols: ProtocolUsage[]
  countries: CountryUsage[]
  domains: DomainUsage[]
  ipRanges: IPRangeUsage[]
  threats: NetworkThreat[]
}

export interface ProtocolUsage {
  protocol: string
  count: number
  bytes: number
}

export interface CountryUsage {
  country: string
  countryCode: string
  connections: number
  bytes: number
}

export interface DomainUsage {
  domain: string
  ip: string
  country: string
  category: string
  reputation: string
  connections: number
}

export interface IPRangeUsage {
  range: string
  organization: string
  country: string
  connections: number
  threatLevel: ThreatLevel
}

export interface NetworkThreat {
  type: string
  indicator: string
  severity: ThreatLevel
  description: string
  source: string
}

export interface YaraMatch {
  ruleName: string
  ruleAuthor: string
  ruleDescription: string
  tags: string[]
  meta: Record<string, string>
  matches: YaraMatchDetail[]
  severity: ThreatLevel
}

export interface YaraMatchDetail {
  offset: number
  identifier: string
  data: string
}

export interface IOC {
  type: IOCType
  value: string
  description: string
  confidence: number
  context: string
  source: string
  tags: string[]
}

export enum IOCType {
  HASH = 'hash',
  IP_ADDRESS = 'ip_address',
  DOMAIN = 'domain',
  URL = 'url',
  EMAIL = 'email',
  FILE_PATH = 'file_path',
  REGISTRY_KEY = 'registry_key',
  MUTEX = 'mutex',
  USER_AGENT = 'user_agent',
  CERTIFICATE = 'certificate'
}

export interface Screenshot {
  id: string
  filename: string
  timestamp: Date
  title?: string
  description?: string
  width: number
  height: number
  fileSize: number
  thumbnailUrl?: string
  fullSizeUrl?: string
}

export interface AnalysisEvent {
  id: string
  timestamp: Date
  type: EventType
  category: EventCategory
  severity: ThreatLevel
  description: string
  processId: number
  processName: string
  details: Record<string, any>
  tags: string[]
}

export enum EventType {
  PROCESS_CREATE = 'process_create',
  PROCESS_TERMINATE = 'process_terminate',
  FILE_CREATE = 'file_create',
  FILE_DELETE = 'file_delete',
  FILE_WRITE = 'file_write',
  REGISTRY_CREATE = 'registry_create',
  REGISTRY_DELETE = 'registry_delete',
  REGISTRY_WRITE = 'registry_write',
  NETWORK_CONNECT = 'network_connect',
  NETWORK_DNS = 'network_dns',
  API_CALL = 'api_call',
  YARA_MATCH = 'yara_match',
  ERROR = 'error'
}

export enum EventCategory {
  PROCESS = 'process',
  FILE = 'file',
  REGISTRY = 'registry',
  NETWORK = 'network',
  API = 'api',
  SECURITY = 'security',
  ERROR = 'error'
}

export interface AnalystNote {
  id: string
  analysisId: string
  analystId: string
  content: string
  timestamp: Date
  isPrivate: boolean
  tags: string[]
}

export interface Artifact {
  id: string
  analysisId: string
  type: ArtifactType
  name: string
  description: string
  path: string
  size: number
  hash: string
  isQuarantined: boolean
  quarantineReason?: string
  createdAt: Date
}

export enum ArtifactType {
  MEMORY_DUMP = 'memory_dump',
  DISK_IMAGE = 'disk_image',
  PCAP = 'pcap',
  LOG_FILE = 'log_file',
  SCREENSHOT = 'screenshot',
  EXTRACTED_FILE = 'extracted_file'
}

// System Health and Monitoring
export interface SystemHealth {
  timestamp: Date
  cpuUsage: number
  memoryUsage: number
  diskUsage: number
  networkLatency: number
  activeAnalysisCount: number
  queuedAnalysisCount: number
  totalAnalysisCount: number
  errorRate: number
  uptime: number
  version: string
}

export interface VMStatus {
  id: string
  name: string
  status: VMStatusType
  os: string
  ipAddress: string
  cpuUsage: number
  memoryUsage: number
  diskUsage: number
  currentAnalysis?: string
  uptime: number
  lastHeartbeat: Date
}

export enum VMStatusType {
  IDLE = 'idle',
  BUSY = 'busy',
  MAINTENANCE = 'maintenance',
  ERROR = 'error',
  OFFLINE = 'offline'
}

export interface JobQueue {
  pending: QueuedJob[]
  running: RunningJob[]
  completed: number
  failed: number
  averageWaitTime: number
  averageProcessingTime: number
}

export interface QueuedJob {
  id: string
  sampleId: string
  profile: AnalysisProfile
  priority: JobPriority
  queueTime: Date
  estimatedStart?: Date
  submittedBy: string
}

export interface RunningJob {
  id: string
  sampleId: string
  analysisId: string
  startTime: Date
  estimatedCompletion: Date
  progress: number
  vmId: string
  status: AnalysisStatus
}

export enum JobPriority {
  LOW = 1,
  NORMAL = 2,
  HIGH = 3,
  CRITICAL = 4
}

// Search and Filter Types
export interface SearchQuery {
  query: string
  filters: SearchFilter[]
  timeRange?: TimeRange
  sortBy?: string
  sortOrder?: 'asc' | 'desc'
  limit?: number
  offset?: number
}

export interface SearchFilter {
  field: string
  operator: FilterOperator
  value: any
}

export enum FilterOperator {
  EQUALS = 'eq',
  NOT_EQUALS = 'ne',
  CONTAINS = 'contains',
  NOT_CONTAINS = 'not_contains',
  GREATER_THAN = 'gt',
  LESS_THAN = 'lt',
  GREATER_EQUAL = 'gte',
  LESS_EQUAL = 'lte',
  IN = 'in',
  NOT_IN = 'not_in'
}

export interface TimeRange {
  start: Date
  end: Date
}

export interface SearchResult<T> {
  items: T[]
  total: number
  page: number
  pageSize: number
  hasMore: boolean
}

// Export and Integration Types
export interface ExportOptions {
  format: ExportFormat
  includeIOCs: boolean
  includeScreenshots: boolean
  includeArtifacts: boolean
  includeRawData: boolean
}

export enum ExportFormat {
  PDF = 'pdf',
  JSON = 'json',
  CSV = 'csv',
  STIX = 'stix',
  XML = 'xml',
  MARKDOWN = 'markdown'
}

export interface Integration {
  id: string
  name: string
  type: IntegrationType
  configuration: IntegrationConfig
  isActive: boolean
  lastSync?: Date
  createdAt: Date
  updatedAt: Date
}

export enum IntegrationType {
  WEBHOOK = 'webhook',
  SLACK = 'slack',
  EMAIL = 'email',
  SIEM = 'siem',
  THREAT_INTEL = 'threat_intel',
  TICKETING = 'ticketing'
}

export interface IntegrationConfig {
  endpoint?: string
  apiKey?: string
  secret?: string
  headers?: Record<string, string>
  events: string[]
  filters: SearchFilter[]
}

// WebSocket Message Types
export interface WebSocketMessage {
  type: WebSocketMessageType
  payload: any
  timestamp: Date
  id: string
}

export enum WebSocketMessageType {
  ANALYSIS_STARTED = 'analysis_started',
  ANALYSIS_COMPLETED = 'analysis_completed',
  ANALYSIS_FAILED = 'analysis_failed',
  ANALYSIS_CANCELLED = 'analysis_cancelled',
  ANALYSIS_PROGRESS = 'analysis_progress',
  SYSTEM_HEALTH_UPDATE = 'system_health_update',
  VM_STATUS_UPDATE = 'vm_status_update',
  NEW_EVENT = 'new_event',
  SCREENSHOT_UPDATE = 'screenshot_update',
  LOG_UPDATE = 'log_update',
  ERROR = 'error'
}

export interface AnalysisProgressMessage {
  analysisId: string
  progress: number
  stage: string
  message: string
  estimatedTimeRemaining?: number
}

export interface NewEventMessage {
  analysisId: string
  event: AnalysisEvent
}

export interface ScreenshotUpdateMessage {
  analysisId: string
  screenshot: Screenshot
}

export interface LogUpdateMessage {
  analysisId: string
  log: string
  level: LogLevel
  timestamp: Date
}

export enum LogLevel {
  DEBUG = 'debug',
  INFO = 'info',
  WARNING = 'warning',
  ERROR = 'error',
  CRITICAL = 'critical'
}

// UI State Types
export interface UIState {
  theme: 'light' | 'dark' | 'system'
  sidebarOpen: boolean
  notifications: Notification[]
  modals: OpenModal[]
  loading: Record<string, boolean>
  errors: Record<string, string>
}

export interface Notification {
  id: string
  type: NotificationType
  title: string
  message: string
  timestamp: Date
  read: boolean
  actions?: NotificationAction[]
}

export enum NotificationType {
  SUCCESS = 'success',
  ERROR = 'error',
  WARNING = 'warning',
  INFO = 'info'
}

export interface NotificationAction {
  label: string
  action: string
  primary?: boolean
}

export interface OpenModal {
  id: string
  type: ModalType
  props: Record<string, any>
}

export enum ModalType {
  UPLOAD_SAMPLE = 'upload_sample',
  ANALYSIS_CONFIG = 'analysis_config',
  EXPORT_REPORT = 'export_report',
  ADD_NOTE = 'add_note',
  CONFIRM_ACTION = 'confirm_action',
  VIEW_ARTIFACTS = 'view_artifacts',
  SYSTEM_SETTINGS = 'system_settings'
}